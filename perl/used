#!/usr/bin/perl -w
##############################################################################
#     Name: used
#
#  Summary: Edit a file in-place without changing its timestamp.
# 
#           u(sed) is derived from uvi u(vi)
#
#  Created: Mon 07 Apr 2014 10:21:25 (Bob Heckel)
##############################################################################

$file = shift or die "usage: used FILENAME\n";
$fileTMP = $file . 'TMP';

($atime, $mtime) = (stat($file))[8,9];

open my $read, '<', $file or die "Error: $0: $!";
###open my $write, '>', 'tmpf' or die "Error: $0: $!";
open my $write, '>', $fileTMP or die "Error: $0: $!";

$b1 = q|<ExtractComment>Material Codes - 0695009, 0695017, 0695025, 0696005, 0696013, 0696021, 0697001, 0697017, 0697028, 4136411, 4136427, 4136438, 4136446, 4148304, 4148312, 4148327, 4148371, 4148387, 4148398, 4148401, 4148417, 4148428, 10000000055245, 100000000|;
$b2 = q|55246,  10000000055247, 10000000055481, 10000000055482, 10000000055483, 10000000055245, 10000000055246, 10000000055247, 10000000059137, 10000000059150, 10000000063059, 10000000059137, 10000000059139, 10000000059150, 10000000063058, 10000000063058, 10000000|;
$b3 = q|063059, 10000000063070, 10000000089315, 10000000089317, 10000000089319,  10000000089323, 10000000089324, 10000000089325, 10000000089330, 10000000089394, 10000000089396, 10000000089421, 60000000002485, 60000000002484, 60000000002483, 60000000002489, 6000000|;
$b4 = q|0002490, 60000000002491, 60000000002488, 60000000002487, 60000000002486, 60000000002596, 60000000002597, 60000000002581, 10000000097328, 10000000097330, 10000000097331</ExtractComment>|;

$a1 = q|<ExtractComment>Material Codes - 0695009, 0695017, 0695025, 0696005, 0696013, 0696021, 0697001, 0697017, 0697028, 10000000055245, 10000000055245, 10000000055246, 10000000055246, 10000000055247, 10000000055481, 10000000055482,|;
$a2 = q|10000000055483, 10000000059137, 10000000059137, 10000000059139, 10000000059150, 10000000059150, 10000000063058, 10000000063058, 10000000063059, 10000000063059, 10000000063070, 10000000089315, 10000000089316, 10000000089317, 10000000089318, 10000000089319,|;
$a3 = q|10000000089320, 10000000089323, 10000000089324, 10000000089325, 10000000089330, 10000000089392, 10000000089393, 10000000089394, 10000000089395, 10000000089396, 10000000089397, 10000000089421, 10000000097328, 10000000097328, 10000000097330, 10000000097330,|;
$a4 = q|10000000097331, 10000000097331, 10000000104757, 10000000104758, 10000000104759, 10000000118454, 10000000118456, 10000000118457, 10000000118458, 10000000118474, 10000000118475, 10000000121656, 10000000121657, 10000000121658, 4136411, 4136427, 4136438,
4136446, 4148304, 4148312, 4148327, 4148371, 4148387, 4148398, 4148401, 4148417, 4148428, 60000000002483, 60000000002484, 60000000002485, 60000000002486, 60000000002487, 60000000002488, 60000000002489, 60000000002490, 60000000002491, 60000000002581,
60000000002596, 60000000002597, 60000000010760, 60000000010761, 60000000010762, 60000000010763, 60000000010764, 60000000010765, 60000000010766, 60000000010767, 60000000010989, 60000000010990, 60000000010991, 60000000011089</ExtractComment>|;

while ( <$read> ){
  s/$b1/$a1/g;
  s/$b2/$a2/g;
  s/$b3/$a3/g;
  s/$b4/$a4/g;
	s///;  # required if we're running on Windows
	print $write $_;
}

utime($atime, $mtime, $fileTMP) or die "Couldn't restore $fileTMP to orig times: $!\n";

close $read or warn "Couldn't close read filehandle: $!\n";
close $write or warn "Couldn't close write filehandle: $!\n";

rename($fileTMP, $file) or die "Couldn't rename $fileTMP: $!\n";
###system("mv", $fileTMP, $file) or die "Couldn't move $fileTMP: $!\n";



__END__

BEFORE
<ExtractComment>Material Codes - 0695009, 0695017, 0695025, 0696005, 0696013, 0696021, 0697001, 0697017, 0697028, 4136411, 4136427, 4136438, 4136446, 4148304, 4148312, 4148327, 4148371, 4148387, 4148398, 4148401, 4148417, 4148428, 10000000055245, 100000000
55246,  10000000055247, 10000000055481, 10000000055482, 10000000055483, 10000000055245, 10000000055246, 10000000055247, 10000000059137, 10000000059150, 10000000063059, 10000000059137, 10000000059139, 10000000059150, 10000000063058, 10000000063058, 10000000
063059, 10000000063070, 10000000089315, 10000000089317, 10000000089319,  10000000089323, 10000000089324, 10000000089325, 10000000089330, 10000000089394, 10000000089396, 10000000089421, 60000000002485, 60000000002484, 60000000002483, 60000000002489, 6000000
0002490, 60000000002491, 60000000002488, 60000000002487, 60000000002486, 60000000002596, 60000000002597, 60000000002581, 10000000097328, 10000000097330, 10000000097331</ExtractComment>

AFTER
<ExtractComment>Material Codes - 0695009, 0695017, 0695025, 0696005, 0696013, 0696021, 0697001, 0697017, 0697028, 10000000055245, 10000000055245, 10000000055246, 10000000055246, 10000000055247, 10000000055481, 10000000055482,
10000000055483, 10000000059137, 10000000059137, 10000000059139, 10000000059150, 10000000059150, 10000000063058, 10000000063058, 10000000063059, 10000000063059, 10000000063070, 10000000089315, 10000000089316, 10000000089317, 10000000089318, 10000000089319,
10000000089320, 10000000089323, 10000000089324, 10000000089325, 10000000089330, 10000000089392, 10000000089393, 10000000089394, 10000000089395, 10000000089396, 10000000089397, 10000000089421, 10000000097328, 10000000097328, 10000000097330, 10000000097330,
10000000097331, 10000000097331, 10000000104757, 10000000104758, 10000000104759, 10000000118454, 10000000118456, 10000000118457, 10000000118458, 10000000118474, 10000000118475, 10000000121656, 10000000121657, 10000000121658, 4136411, 4136427, 4136438,
4136446, 4148304, 4148312, 4148327, 4148371, 4148387, 4148398, 4148401, 4148417, 4148428, 60000000002483, 60000000002484, 60000000002485, 60000000002486, 60000000002487, 60000000002488, 60000000002489, 60000000002490, 60000000002491, 60000000002581,
60000000002596, 60000000002597, 60000000010760, 60000000010761, 60000000010762, 60000000010763, 60000000010764, 60000000010765, 60000000010766, 60000000010767, 60000000010989, 60000000010990, 60000000010991, 60000000011089</ExtractComment>
